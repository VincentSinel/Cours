!function(t){function r(t){if("number"==typeof t)return t.toString();var r={"<":"lt",">":"gt",'"':"quot","'":"apos"};for(var a in r)t=t.replace(new RegExp(a,"g"),"&"+r[a]+";");return t}function a(t,r){var a,e=[];if(void 0!==t.unshift){var n=t.length;for(a=0;a<n;a++){if(void 0!==t[a])null!==(i=r.call(this,t[a],a))&&e.push(i)}}else for(a in t){var i;if(t.hasOwnProperty(a))null!==(i=r.call(this,t[a],a))&&e.push(i)}return e}function e(t,r,a){for(var e in t)t.hasOwnProperty(e)&&(a=r.call(this,a,t[e],e));return a}function n(e,n,i,s){return null==s&&(s=""),"object"==typeof n&&(n=a(n,(function(a,e){switch(e){case"transform":return;case"fill":if(a.match(/^hsb/)){var n=a.replace(/^hsb\(|\)$/g,"").split(",");3===n.length&&(a=t.hsb2rgb(n[0],n[1],n[2]).toString())}}return e+'="'+r(a)+'"'})).join(" ")),"<"+e+(i?' transform="matrix('+i.toString().replace(/^matrix\(|\)$/g,"")+')" ':" ")+n+">"+s+"</"+e+">"}function s(t){var r="normal",a="text-anchor: "+(t.anchor||"middle")+"; ",e=t.font;return a+["font:",e.style||r,r,e.weight||r,(e.size?e.size+"px":"10px")+"/normal",e.family].join(" ")}function o(t){return/^[0-9A-F]{6}$/i.test(t)&&(t="#"+t),t}function l(t,r,a){return null===t&&(t=10),4.5*t/13*(r-.2-a/2)*3.5}var f={text:function(t){var i=function(t){return{font:{family:void 0===t.attrs.font?null:t.attrs.font.replace(/^.?"(\w+)".$/,"$1"),size:void 0===t.attrs["font-size"]?null:parseInt(t.attrs["font-size"]),style:void 0===t.attrs["font-style"]?null:t.attrs["font-style"],weight:void 0===t.attrs["font-weight"]?null:t.attrs["font-weight"]},anchor:void 0===t.attrs["text-anchor"]?null:t.attrs["text-anchor"]}}(t),f=new Array,c=t.attrs.text.toString().split("\n"),u=c.length;return a(c,(function(a,c){var h=e(t.attrs,(function(t,a,e){return"text"!==e&&"w"!==e&&"h"!==e&&("font-size"===e&&(a=parseInt(a)+"px"),"stroke"===e&&(a=o(a)),t[e]=r(a.toString())),t}),{style:s(i)+";"});""!=t.node.className.baseVal&&void 0!==t.node.className.baseVal&&(h.class=t.node.className.baseVal),f.push(n("text",h,t.matrix,n("tspan",{dy:l(i.font.size,c+1,u)},null,a.replace(/&/g,"&amp;"))))})),f},path:function(t){1===t.matrix.a&&1===t.matrix.d||t.matrix.toString();return n("path",e(t.attrs,(function(t,r,a){return"path"===a&&(a="d"),"stroke"===a&&(r=o(r)),t[a]=r.toString(),t}),{}),t.matrix)}};t.fn.toSVG=function(){var a=this,e={svg:t.svg,vml:t.vml},n='<svg style="overflow: hidden; position: relative;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+a.width+'" version="1.1" height="'+a.height+'">';t.svg=!0,t.vml=!1;for(var s=a.bottom;null!=s;s=s.next)if("none"!==s.node.style.display){var l="";if("function"!=typeof f[s.type]){if("image"===s.type)l+=' preserveAspectRatio="none"';for(i in s.attrs){var c=i,u="";switch(i){case"r":if("rect"!=s.type)break;u=s.attrs.r,s.attrs.rx=u,s.attrs.ry=u;continue;case"src":c="xlink:href";break;case"transform":c="";break;case"fill":if(s.attrs.gradient)continue;break;case"gradient":var h=s.id,p=s.attrs.gradient,d=.5,g=.5;if(p=(p=String(p).replace(t._radial_gradient,(function(t,r,a){if(type="radial",r&&a){d=parseFloat(r);var e=2*((g=parseFloat(a))>.5)-1;Math.pow(d-.5,2)+Math.pow(g-.5,2)>.25&&(g=Math.sqrt(.25-Math.pow(d-.5,2))*e+.5)&&.5!=g&&(g=g.toFixed(5)-1e-5*e)}return""}))).split(/\s*\-\s*/),s.attrs.gradient.match(/^r/g)){if(!(x=t._parseDots(p)))continue;n+="<defs>",n+='\t    <radialGradient id="radialgradient'+h+'" fx="'+d+'" fy="'+g+'" >';for(var v=0;v<x.length;v++){var m=v/(x.length-1)*100+"%";x[v].offset&&(m=x[v].offset),n+='<stop stop-color="'+x[v].color+'" offset="'+m+'"/>'}n+="    </radialGradient>",n+="</defs>",c="fill",u="url(#radialgradient"+h+")"}else{var x,w=p.shift();if(w=-1*parseFloat(w),isNaN(w))continue;if(!(x=t._parseDots(p)))continue;var y=[0,0,Math.cos(t.rad(w)),Math.sin(t.rad(w))],b=1/(Math.max(Math.abs(y[2]),Math.abs(y[3]))||1);y[2]*=b,y[3]*=b,y[2]<0&&(y[0]=-y[2],y[2]=0),y[3]<0&&(y[1]=-y[3],y[3]=0),n+="<defs>",n+='\t    <linearGradient id="lineargradient'+h+'" x1="'+y[0]+'" y1="'+y[1]+'" x2="'+y[2]+'" y2="'+y[3]+'">';for(v=0;v<x.length;v++){m=v/(x.length-1)*100+"%";x[v].offset&&(m=x[v].offset),n+='<stop stop-color="'+x[v].color+'" offset="'+m+'"/>'}n+="    </linearGradient>",n+="</defs>",c="fill",u="url(#lineargradient"+h+")"}break;case"stroke":u=o(u||s.attrs[i].toString())}c&&(l+=u?" "+c+'="'+r(u)+'"':" "+c+'="'+r(s.attrs[i].toString())+'"')}""!=s.node.className.baseVal&&(l+=' class="'+s.node.className.baseVal+'"'),n+="<"+s.type+' transform="matrix('+s.matrix.toString().replace(/^matrix\(|\)$/g,"")+')"'+l+"></"+s.type+">"}else n+=f[s.type](s)}return n+="</svg>",t.svg=e.svg,t.vml=e.vml,n}}(window.Raphael);